# 死結問題
多筆交易 (行程) 相互等待對方所持有資源的僵局現象，有四個條件
1. 互斥：一個資源同時只能給一個行程使用
2. 持有並等待：行程取得某些資源且等待其他資源
3. 不可搶先：行程已取得的資源不能強行被移除
4. 循環等待：多個行程相互等待彼此所持有的資源

可以透過預防 (Prevention) 或偵測 (Detection) 解決上述問題

# 飢餓現象
一行程被無止盡的凍結，如動態環境下，低優先權行程持續等待高優先權程序先執行

# 死結預防 (Prevention)
<mark>讓四大條件之一不成立</mark>
1. 破壞互斥：只能盡量減少
2. 破壞持有並等待：要求行程一次索取所有所需資源，並懸置行程直到可以同時取得所有資源為止，但有 3缺點
	1. 行程可能因無法同時取得所有資源而長期懸置 (飢餓)
	2. 被持有的資源可能長期處於閒置狀態，使用效率差
	3. 行程無法事先知道全部所需資源
3. 破壞不可搶先：OS 可要求低優先度行程釋放資源給高優先度行程，可能造成飢餓現象
4. 破壞循環等待：依資源類型定義順序，取得某類資源的行程只能請求後面順序的幾類資源

# 死結避免 (Avoidance)
依事先知道行程所需的資源，評估是否發生死結，以決定後續處理工作
策略：
1. 行程啟動可能造成死結，拒絕啟動行程
2. 啟動後的資源請求可能造成死結，拒絕配置

# 死結偵測與回復
允許死結發生，因此系統需要有偵測死結的能力與回復正常運作的策略
1. 偵測技術：
	1. 等待圖：[[資源分配圖.png]]
	2. 逾時：等待時間過長
2. 復原策略：
	選擇造成死結的行程，終止→撤回→重新執行
	1.  一次終止：一次終止所有陷入死結的行程，最常採用
	2.  撤回且重新啟動：將所有陷入死結的行程 ROLLBACK 到先前的檢查點 (CHECKPOINT)
	3.  逐一終止：逐一終止最小成本的行程，直到死結狀態解除
	4.  逐一搶回：以最小成本逐一搶回行程持有的資源，直到死結狀態解除

# 總結

<table>
    <thead>
        <tr>
            <th>方法</th>
            <th>資源分配</th>
            <th>各種方案</th>
			<th>優點</th>
			<th>缺點</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan=3>預防</td>
            <td rowspan=3>保守</td>
            <td>一次要求所有資源</td>
			<td>適合僅需少量運算資源行程</td>
			<td>無效率，可能飢餓。事先知道所需資源</td>
        </tr>
        <tr>
            <td>優先權式可搶先</td>
			<td>方便，容易執行</td>
			<td>有飢餓，過多搶先</td>
        </tr>
        <tr>
            <td>資源分類排序</td>
            <td>編譯過程處理</td>
			<td>不必要的請求拒絕</td>
        </tr>
        <tr>
            <td>避免</td>
			<td>均衡</td>
			<td>找行程可執行順序</td>
			<td>不須搶先</td>
			<td>事先知道所需資源</td>
        </tr>
		<tr>
            <td>偵測</td>
			<td>自由</td>
			<td>週期性尋找死結</td>
			<td>行程立即執行，適合線上處理</td>
			<td>重啟運算浪費資源，注意犧牲者選擇策略</td>
        </tr>
    </tbody>
</table>

[回到索引]((%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1%E7%B4%A2%E5%BC%95))